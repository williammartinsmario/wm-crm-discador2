
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>CRM WM â€“ ImportaÃ§Ã£o FlexÃ­vel</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f7fb; }
    input, button { margin: 5px 0; padding: 5px; }
    #output { margin-top: 20px; }
    .contato { border: 1px solid #ccc; padding: 10px; margin-bottom: 5px; background: white; }
  </style>
</head>
<body>
  <h2>CRM WM â€“ ImportaÃ§Ã£o CSV / XLSX / Colagem</h2>
  <label>ğŸ“ Importar CSV:</label><br>
  <input type="file" accept=".csv" id="csvFileInput" onchange="importarCSV(this.files[0])"><br><br>

  <label>ğŸ“Š Importar Excel (.xlsx):</label><br>
  <input type="file" accept=".xlsx" onchange="importarXLSX(this.files[0])"><br><br>

  <label>ğŸ“‹ Colar dados (nome e nÃºmero separados por vÃ­rgula, ponto e vÃ­rgula ou espaÃ§o):</label><br>
  <textarea id="textoColado" rows="6" cols="50"></textarea><br>
  <button onclick="importarTextoInteligente(document.getElementById('textoColado').value)">Importar Colagem</button>

  <div id="output"></div>

<script>
function importarTextoInteligente(texto) {
  const linhas = texto.trim().split(/\r?\n/);
  const output = document.getElementById("output");
  output.innerHTML = "";
  linhas.forEach(linha => {
    let partes = linha.split(/[;,\t ]+/);
    if (partes.length >= 2) {
      let nome = partes[0];
      let numero = partes[1].replace(/[^\d]/g, "");
      if (numero.length >= 10) {
        let div = document.createElement("div");
        div.className = "contato";
        div.innerHTML = `<strong>${nome}</strong><br>${numero}`;
        output.appendChild(div);
      }
    }
  });
}

function importarCSV(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    let texto = e.target.result.trim();
    if (texto.includes("NOME") && texto.includes("TELEFONE")) {
      texto = texto.replace(/NOME/gi, "nome").replace(/TELEFONE/gi, "numero");
    }
    importarTextoInteligente(texto);
  };
  reader.readAsText(file, "UTF-8");
}

function importarXLSX(file) {
  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, {type: 'array'});
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(sheet, {header: 1});
    const linhas = json.map(row => row.join(";")).join("\n");
    importarTextoInteligente(linhas);
  };
  reader.readAsArrayBuffer(file);
}
</script>
</body>
</html>
