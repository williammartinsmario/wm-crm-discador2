<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>WM Assessoria ‚Äì CRM &amp; Discador</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&amp;display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Poppins',sans-serif;background:#f4f6f9;color:#333}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 24px;background:#fff;
  border-bottom:2px solid #e5e7eb;flex-wrap:wrap;gap:12px}
header h1{font-size:22px;color:#003366;font-weight:600;white-space:nowrap}
header img{height:46px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border:none;border-radius:8px;font-weight:600;
  font-size:13px;cursor:pointer;transition:.25s;white-space:nowrap}
.btn:hover{opacity:.9;transform:translateY(-1px)}
.btn-primary{background:#007bff;color:#fff}
.btn-success{background:#25D366;color:#fff}
.btn-warning{background:#ffc107;color:#000}
.btn-danger{background:#dc3545;color:#fff}
.btn-info{background:#17a2b8;color:#fff}
.btn-light{background:#f1f3f5;color:#333}

#top-bar{display:flex;align-items:center;flex-wrap:wrap;gap:8px;padding:10px 24px;background:#fafafa;
  border-bottom:1px solid #ddd}
#top-bar input[type="file"]{padding:4px 6px;font-size:13px}
#top-bar input[type="text"],#top-bar select{padding:6px 8px;border:1px solid #ccc;border-radius:6px;font-size:13px}

#contador{padding:10px 24px;font-weight:600;color:#444;font-size:14px}
.kanban-board{display:flex;gap:12px;padding:10px 12px;overflow-x:auto}
.kanban-column{background:#fff;border-radius:8px;padding:8px;min-width:220px;max-height:calc(100vh - 260px);
  overflow-y:auto;box-shadow:0 1px 3px rgba(0,0,0,.08);flex-shrink:0}
.kanban-column h3{font-size:14px;margin-bottom:6px;color:#003366}
.card{background:#f9f9f9;border-radius:6px;padding:8px;margin-bottom:8px;box-shadow:0 1px 2px rgba(0,0,0,.04);
  font-size:13px}
.card textarea{width:100%;margin-top:4px;border-radius:4px;font-size:12px;padding:4px 6px}
.badge-alerta{background:#ffc107;color:#000;padding:0 4px;border-radius:4px;font-size:10px;margin-left:4px}

#agendaLista{background:#fff;margin:10px 24px;padding:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.08)}
#agendaLista h2{font-size:16px;margin-bottom:6px;color:#003366}

.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.45);display:none;
  align-items:center;justify-content:center;z-index:1100;padding:12px}
.modal-content{background:#fff;padding:16px;border-radius:8px;width:90%;max-width:380px}

footer{padding:10px;text-align:center;font-size:12px;background:#003366;color:#fff;margin-top:30px}

/* Painel de detalhes */
#painelDetalhes{display:none;position:fixed;top:0;right:0;width:320px;height:100%;background:#fff;
  box-shadow:-2px 0 6px rgba(0,0,0,.2);z-index:1200;padding:18px;overflow:auto}
#painelDetalhes h3{margin-bottom:8px;color:#003366}

/* Painel IA */
#aiPanel{display:none;position:fixed;top:0;right:0;width:380px;height:100%;background:#ffffff;
  box-shadow:-2px 0 6px rgba(0,0,0,.2);z-index:1300;padding:16px;overflow:auto}
#aiPanel h3{margin-bottom:6px;color:#003366}
#openAIButton{position:fixed;bottom:20px;right:20px;background:#17a2b8;color:#fff;border:none;padding:12px 16px;
  border-radius:50%;font-size:20px;box-shadow:0 4px 6px rgba(0,0,0,.3);z-index:1350;cursor:pointer}

/* Modal paste preview textarea */
#pastePreview{background:#f9fafb;border:1px solid #d1d5db;border-radius:6px;padding:6px;margin-top:6px;
  max-height:130px;overflow:auto;font-size:12px;font-family:monospace;color:#003366}
</style>
</head>
<body>
<header>
<div style="display:flex;align-items:center;gap:12px">
<img alt="Logo" src="logo.png"/>
<h1>WM CRM &amp; Discador</h1>
</div>
</header>
<div id="top-bar">
<input accept=".csv" class="btn-light" id="fileInput" type="file"/>
<button class="btn-primary" id="btnPaste">üìã Colar Contatos</button>
<label class="btn-primary" for="importJson" style="cursor:pointer">üìÇ Importar JSON</label>
<input accept="application/json" id="importJson" style="display:none" type="file"/>
<button class="btn-warning" id="exportBtn">üíæ Backup</button>
<input id="searchNome" placeholder="üîç Filtrar nome" type="text"/>
<select id="filterLead">
<option value="">Todos Leads</option>
<option value="Quente">üî• Quente</option>
<option value="Frio">‚ùÑÔ∏è Frio</option>
<option value="Aguardando">‚è≥ Aguardando</option>
</select>
</div>
<p id="contador">üìä Liga√ß√µes feitas hoje: 0</p>
<div id="agendaLista"><h2>üìÖ Pr√≥ximos Agendamentos</h2><div id="listaAgendas"></div></div>
<div class="kanban-board" id="kanbanBoard">
<div class="kanban-column" id="novo"><h3>üì• Novo</h3></div>
<div class="kanban-column" id="atendimento"><h3>üìû Em Atendimento</h3></div>
<div class="kanban-column" id="aguardando"><h3>‚è≥ Aguardando</h3></div>
<div class="kanban-column" id="fechado"><h3>‚úÖ Fechado</h3></div>
<div class="kanban-column" id="descartado"><h3>‚ùå Descartado</h3></div>
</div>
<!-- Modal Agendar -->
<div class="modal" id="modalAgendar">
<div class="modal-content">
<h3>Agendar contato</h3>
<input id="agendaData" style="width:100%;margin-bottom:6px" type="datetime-local"/>
<textarea id="agendaMsg" placeholder="Mensagem para o WhatsApp" rows="3" style="width:100%"></textarea>
<div style="display:flex;gap:10px;justify-content:flex-end;margin-top:10px">
<button class="btn-danger" id="cancelAgenda">Cancelar</button>
<button class="btn-success" id="saveAgenda">Agendar</button>
</div>
</div>
</div>
<!-- Modal Paste -->
<div class="modal" id="modalPaste">
<div class="modal-content">
<h3>Colar contatos</h3>
<textarea id="pasteTextarea" placeholder="Cole aqui sua lista..." rows="8" style="width:100%;"></textarea>
<div style="display:flex;gap:10px;justify-content:flex-end;margin:8px 0">
<button class="btn-warning" id="btnAnalisarPaste">Analisar</button>
</div>
<div id="pastePreview"></div>
<div style="display:flex;gap:10px;justify-content:flex-end;margin-top:10px">
<button class="btn-danger" id="btnCancelarPaste">Cancelar</button>
<button class="btn-success" disabled="" id="btnSalvarPaste">Salvar</button>
</div>
</div>
</div>
<footer>¬© 2025 WM Assessoria ‚Äì CRM local</footer>
<!-- Painel de detalhes -->
<div id="painelDetalhes">
<h3>Detalhes do Lead</h3>
<div id="painelConteudo"></div>
<button class="btn-danger" onclick="fecharPainel()" style="margin-top:10px">Fechar</button>
</div>
<!-- Painel IA -->
<div id="aiPanel">
<h3>Assistente IA</h3>
<label>Projeto:</label>
<select id="aiProject" style="width:100%;padding:6px;margin-bottom:8px">
<option>Mangar√°</option>
<option>Rise</option>
<option>Seleto</option>
<option>Alentejo</option>
<option>Algarve</option>
</select>
<label>Upload (texto / imagem / PDF):</label>
<input id="aiFile" style="width:100%;margin-bottom:6px" type="file"/>
<button class="btn-primary" onclick="uploadAIFile()">Enviar Arquivo</button>
<hr/>
<textarea id="aiPrompt" placeholder="Digite sua pergunta..." rows="4" style="width:100%"></textarea>
<button class="btn-success" onclick="sendAIPrompt()" style="margin-top:6px">Perguntar</button>
<pre id="aiAnswer" style="margin-top:10px;white-space:pre-wrap;font-size:14px"></pre>
<button class="btn-danger" onclick="toggleAIPanel()" style="position:absolute;top:8px;right:8px">‚úñ</button>
</div>
<!-- Bot√£o IA -->
<button id="openAIButton" title="Assistente IA">ü§ñ</button>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script>
/* ---------- Dados principais ---------- */
const STORAGE_KEY = 'leadsKanban';
const CALL_KEY = 'callCounter';
let leads = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let leadAtual = null;

/* ---------- Utils ---------- */
function salvarLeads(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(leads)); }
function hojeISO(){ return new Date().toISOString().split('T')[0]; }

/* ---------- Contador de liga√ß√µes ---------- */
function incrementarContador(){
  const saved = JSON.parse(localStorage.getItem(CALL_KEY)) || {date: hojeISO(), count:0};
  if(saved.date !== hojeISO()){ saved.date = hojeISO(); saved.count = 0; }
  saved.count++;
  localStorage.setItem(CALL_KEY, JSON.stringify(saved));
  document.getElementById('contador').textContent = 'üìä Liga√ß√µes feitas hoje: '+saved.count;
}
function carregarContador(){
  const saved = JSON.parse(localStorage.getItem(CALL_KEY)) || {date: hojeISO(), count:0};
  if(saved.date !== hojeISO()){ saved.count = 0; }
  document.getElementById('contador').textContent = 'üìä Liga√ß√µes feitas hoje: '+saved.count;
}

/* ---------- Render ---------- */
function render(){
  const statusList = ['novo','atendimento','aguardando','fechado','descartado'];
  const statusColors = {
    novo:'#007bff', atendimento:'#ffc107', aguardando:'#ff8800', fechado:'#28a745', descartado:'#dc3545'
  };
  const now = new Date();
  const search = document.getElementById('searchNome').value.toLowerCase();
  const filtroLead = document.getElementById('filterLead').value;

  statusList.forEach(status=>{
    const coluna = document.getElementById(status);
    const titulo = coluna.querySelector('h3').outerHTML;
    coluna.innerHTML = titulo;

    leads.filter(l=>l.status===status)
      .filter(l=>!search || l.nome.toLowerCase().includes(search))
      .filter(l=>!filtroLead || (l.leadType||'')===filtroLead)
      .forEach(l=>{
        const agendaData = l.agenda && l.agenda.length ? new Date(l.agenda[0].data) : null;
        const diffDays = agendaData ? Math.floor((now - agendaData) / (1000*60*60*24)) : 99;

        const card = document.createElement('div');
        card.className='card';
        card.dataset.nome=l.nome;
        card.style.borderLeft='4px solid '+statusColors[status];
        if(diffDays>3 && status!=='fechado'){ card.style.border='2px solid #dc3545'; }

        const tag = l.tag ? '<span class="badge-alerta">'+l.tag+'</span>' : '';
        const agendaTxt = agendaData ? "<div style='font-size:11px;color:#003366'>üìÖ "+agendaData.toLocaleString()+"</div>" : '';

        card.innerHTML = `
          <strong style="cursor:pointer" onclick="abrirPainel('${l.nome}')">${l.nome}</strong> ${tag}
          <div>${l.numero}</div>
          <textarea rows="2" placeholder="Observa√ß√µes..." onchange="editarObs('${l.nome}',this.value)">${l.obs||''}</textarea>
          ${agendaTxt}
          <div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:6px">
            <button class="btn btn-danger" onclick="ligarLead('${l.numero}')">üìû</button>
            <button class="btn btn-success" onclick="window.open('https://wa.me/55${l.numero}','_blank')">üí¨</button>
            <button class="btn btn-primary" onclick="openModal('${l.nome}')">üìÖ</button>
            <button class="btn btn-warning" onclick="editarLead('${l.nome}')">‚úèÔ∏è</button>
            <button class="btn btn-info" onclick="confirmarVisita('${l.nome}', '${l.numero}', '${l.status}', '${agendaData?agendaData.toLocaleString():''}')">‚úâÔ∏è</button>
            <button class="btn btn-danger" onclick="excluirLead('${l.nome}')">‚ùå</button>
          </div>
        `;
        coluna.appendChild(card);
      });
  });

  renderAgendas();
}
function renderAgendas(){
  const lista = document.getElementById('listaAgendas');
  lista.innerHTML='';
  const ags = [];
  leads.forEach(l=>{
    if(l.agenda&&l.agenda.length){
      l.agenda.forEach(a=>ags.push({...a, nome:l.nome, numero:l.numero }));
    }
  });
  ags.sort((a,b)=>new Date(a.data)-new Date(b.data));
  ags.forEach(a=>{
    const div=document.createElement('div');
    div.style.fontSize='13px';
    div.innerHTML=`${new Date(a.data).toLocaleString()} ‚Äì <strong>${a.nome}</strong> ‚Ä¢ ${a.msg}`;
    lista.appendChild(div);
  });
}

/* ---------- A√ß√µes dos leads ---------- */
function editarObs(nome,val){ const l=leads.find(x=>x.nome===nome); if(l){l.obs=val;salvarLeads();} }
function editarLead(nome){ const l=leads.find(x=>x.nome===nome); if(!l)return; const novoNome=prompt('Novo nome',l.nome)||l.nome;
  const novoNumero=prompt('Novo n√∫mero',l.numero)||l.numero; l.nome=novoNome; l.numero=novoNumero; salvarLeads(); render(); }
function excluirLead(nome){ if(!confirm('Excluir lead?'))return; leads=leads.filter(x=>x.nome!==nome); salvarLeads(); render(); }
function ligarLead(numero){ incrementarContador(); window.location.href='tel:+55'+numero; }

/* ---------- Modal Agenda ---------- */
function openModal(nome){
  leadAtual = leads.find(l=>l.nome===nome);
  agendaData.value='';
  agendaMsg.value='Ol√° '+leadAtual.nome+', tudo bem? ';
  modalAgendar.style.display='flex';
}
cancelAgenda.onclick = ()=>modalAgendar.style.display='none';
saveAgenda.onclick = ()=>{
  if(!agendaData.value || !agendaMsg.value.trim())return;
  leadAtual.agenda = leadAtual.agenda || [];
  leadAtual.agenda.push({data:agendaData.value,msg:agendaMsg.value});
  salvarLeads();
  modalAgendar.style.display='none';
  render();
  window.open('https://wa.me/55'+leadAtual.numero+'?text='+encodeURIComponent(agendaMsg.value+' '+new Date(agendaData.value).toLocaleString()),'_blank');
};

/* ---------- Painel lateral ---------- */
function abrirPainel(nome){
  const l=leads.find(x=>x.nome===nome); if(!l)return;
  const agendaData = l.agenda && l.agenda.length ? new Date(l.agenda[0].data).toLocaleString() : 'Sem agendamento';
  painelConteudo.innerHTML=`
    <p><strong>Nome:</strong> ${l.nome}</p>
    <p><strong>N√∫mero:</strong> ${l.numero}</p>
    <p><strong>Status:</strong> ${l.status}</p>
    <p><strong>Observa√ß√£o:</strong><br>${l.obs||'‚Äî'}</p>
    <p><strong>Agenda:</strong><br>${agendaData}</p>
    <div style="display:flex;gap:6px;margin-top:8px">
      <button class="btn btn-success" onclick="window.open('https://wa.me/55${l.numero}','_blank')">üí¨ WhatsApp</button>
      <button class="btn btn-primary" onclick="openModal('${l.nome}')">üìÖ Agendar</button>
    </div>
  `;
  painelDetalhes.style.display='block';
}
function fecharPainel(){ painelDetalhes.style.display='none'; }

/* ---------- Importa√ß√£o CSV ---------- */
fileInput.onchange = e=>{
  const f=e.target.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=ev=>{
    const linhas=ev.target.result.split(/\r?\n/).slice(1);
    linhas.forEach(l=>{
      const [nome,numero]=l.split(',').map(s=>s.trim());
      if(nome && numero){ leads.push({nome,numero,status:'novo'}); }
    });
    salvarLeads(); render();
  };
  r.readAsText(f);
};

/* ---------- Exporta√ß√£o ---------- */
exportBtn.onclick = ()=>{
  const blob=new Blob([JSON.stringify(leads)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='leads_backup_'+hojeISO()+'.json';
  a.click();
  URL.revokeObjectURL(a.href);
};

/* ---------- Importa√ß√£o JSON ---------- */
importJson.onchange = e=>{
  const f=e.target.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=ev=>{
    try{
      const d=JSON.parse(ev.target.result);
      if(Array.isArray(d)){ leads=d; salvarLeads(); render(); alert('Importado!'); }
      else throw 'Formato inv√°lido';
    }catch(err){ alert('Erro: '+err); }
  };
  r.readAsText(f);
};

/* ---------- Buscar & filtrar ---------- */
searchNome.oninput = filterLeadChange;
filterLead.onchange = filterLeadChange;
function filterLeadChange(){ render(); }

/* ---------- Drag & drop Kanban ---------- */
['novo','atendimento','aguardando','fechado','descartado'].forEach(id=>{
  new Sortable(document.getElementById(id),{
    group:'kanban',
    animation:150,
    onEnd:e=>{
      const nome=e.item.dataset.nome;
      const novoStatus=e.to.id;
      const l=leads.find(x=>x.nome===nome);
      if(l){l.status=novoStatus;salvarLeads();}
    }
  });
});

/* ---------- Colar contatos ---------- */
btnPaste.onclick = ()=>{modalPaste.style.display='flex'; pasteTextarea.value=''; pastePreview.textContent=''; btnSalvarPaste.disabled=true;};
btnCancelarPaste.onclick = ()=>{modalPaste.style.display='none';};
btnAnalisarPaste.onclick = ()=>{
  const texto = pasteTextarea.value;
  const lista = parsePastedContacts(texto);
  if(!lista.length){ pastePreview.textContent='Nada encontrado.'; btnSalvarPaste.disabled=true; return; }
  pastePreview.textContent = lista.map(c=>c.nome+' ‚Äì '+c.numero).join('\\n');
  btnSalvarPaste.dataset.lista = JSON.stringify(lista);
  btnSalvarPaste.disabled=false;
};
btnSalvarPaste.onclick = ()=>{
  const lista = JSON.parse(btnSalvarPaste.dataset.lista||'[]');
  lista.forEach(c=>leads.push({...c,status:'novo'}));
  salvarLeads(); render();
  modalPaste.style.display='none';
};

/* ---------- Parse pasted text ---------- */
function parsePastedContacts(text){
  const linhas = text.split(/\\r?\\n/);
  const contatos = [];
  linhas.forEach(l=>{
    const line = l.trim();
    if(!line) return;
    const digits = line.replace(/\\D/g,'');
    if(digits.length<10) return;
    let numero = digits;
    if(numero.startsWith('55') && numero.length>11) numero = numero.slice(2);
    if(numero.length>11) numero = numero.slice(-11);
    // remove numero occurrences from line to get nome
    let nome = line.replace(/[0-9\\s,;.-]/g,' ').replace(/\\s+/g,' ').trim();
    if(!nome) nome = 'Contato '+numero.slice(-4);
    contatos.push({nome,numero});
  });
  return contatos;
}

/* ---------- IA Panel logic (place‚Äëholder) ---------- */
openAIButton.onclick = toggleAIPanel;
function toggleAIPanel(){ aiPanel.style.display = (aiPanel.style.display==='block')?'none':'block'; }
async function uploadAIFile(){ alert('Endpoint local n√£o implementado nesta vers√£o demo.'); }
async function sendAIPrompt(){ alert('Endpoint local n√£o implementado nesta vers√£o demo.'); }

/* ---------- Inicializa√ß√£o ---------- */
carregarContador();
render();
</script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
function importarTexto() {
  const texto = document.getElementById('textInput').value.trim();
  const linhas = texto.split(/\n+/);
  linhas.forEach(linha => {
    let partes = linha.split(/[;,\t ]+/);
    if (partes.length >= 2) {
      let nome = partes[0];
      let numero = partes[1].replace(/[^\d]/g, "");
      if (numero.length >= 10) {
        adicionarContato(nome, numero);
      }
    }
  });
}

document.getElementById('csvFileInput').addEventListener('change', function(e) {
  const reader = new FileReader();
  reader.onload = function(evt) {
    const texto = evt.target.result;
    const linhas = texto.split(/\r?\n/);
    linhas.forEach(linha => {
      let partes = linha.split(/[;,\t]+/);
      if (partes.length >= 2) {
        let nome = partes[0];
        let numero = partes[1].replace(/[^\d]/g, "");
        if (numero.length >= 10) {
          adicionarContato(nome, numero);
        }
      }
    });
  };
  reader.readAsText(e.target.files[0]);
});

document.getElementById('xlsxFileInput').addEventListener('change', function(e) {
  const reader = new FileReader();
  reader.onload = function(evt) {
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, {type: 'array'});
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(sheet, {header: 1});
    json.forEach(row => {
      if (row.length >= 2) {
        let nome = row[0];
        let numero = ("" + row[1]).replace(/[^\d]/g, "");
        if (numero.length >= 10) {
          adicionarContato(nome, numero);
        }
      }
    });
  };
  reader.readAsArrayBuffer(e.target.files[0]);
});

function adicionarContato(nome, numero) {
  // Cria um novo card no primeiro quadro do Kanban
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `<h4>${nome}</h4><p>${numero}</p>`;
  document.querySelector('.quadro').appendChild(card);
}
</script>
<script>
function preencherMensagem() {
  const nome = document.getElementById("agNome").value || "[nome]";
  const data = document.getElementById("agData").value || "[data]";
  const projeto = document.getElementById("agProjeto").value;
  let mensagem = "";

  const mensagens = {
    "Mangar√° ‚Äì Cores da Mata": `Ol√° ${nome}, tudo certo?\n\nConfirmando seu agendamento para visitar o Mangar√° ‚Äì Cores da Mata no dia ${data}.\nüìç Av. Gra√ßa Aranha, 175 - Vila Miguel Vicente Cury, Campinas - SP\n\nApartamentos com su√≠te, varanda, lazer completo e entrada facilitada.\n\nNos vemos l√°!`,
    "Seleto Amoreiras": `Ol√° ${nome}, tudo bem?\n\nSua visita ao Seleto Amoreiras est√° confirmada para o dia ${data}.\nüìç Av. Amoreiras, Campinas - SP\n\nApartamentos com excelente localiza√ß√£o, su√≠te, varanda gourmet e muito lazer.\n\nTe espero l√°!`,
    "Rise Condom√≠nio Clube": `Ol√° ${nome}, tudo certo?\n\nPassando para confirmar sua visita ao Rise Condom√≠nio Clube no dia ${data}.\nüìç Campinas/SP - Ao lado do Shopping das Bandeiras\n\nCondom√≠nio clube completo com op√ß√µes de 2 e 3 dorms.\n\nVamos juntos nessa conquista!`,
    "Alentejo Residencial": `Oi ${nome}, tudo certo?\n\nSua visita ao Alentejo Residencial foi agendada para o dia ${data}.\nüìç Av. Gra√ßa Aranha, 175 - Campinas - SP\n\nApartamentos de 2 e 3 dorms com varanda gourmet e muito lazer.\n\nNos vemos em breve!`,
    "Algarve Residencial": `Ol√° ${nome}, tudo certo?\n\nConfirmando sua visita ao Algarve Residencial para o dia ${data}.\nüìç Av. Gra√ßa Aranha, 175 - Campinas/SP\n\nApartamentos com su√≠te, churrasqueira a g√°s e √°rea de lazer completa.\n\nAguardo voc√™!`
  };

  if (mensagens[projeto]) {
    mensagem = mensagens[projeto];
  }

  document.getElementById("agMensagem").value = mensagem;
}

function copiarMensagem() {
  const msg = document.getElementById("agMensagem");
  msg.select();
  document.execCommand("copy");
  alert("Mensagem copiada com sucesso!");
}
</script>
<script>
function backupColuna(idColuna) {
  const coluna = document.getElementById(idColuna);
  const cards = coluna.querySelectorAll(".card");
  let csv = "Nome;N√∫mero;Extra\n";
  cards.forEach(card => {
    let nome = card.querySelector("h4")?.innerText || "";
    let numero = card.querySelector("p")?.innerText || "";
    let extra = card.getAttribute("data-nasc") || "";
    csv += `${nome};${numero};${extra}\n`;
  });
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = idColuna + "_backup.csv";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>
<script>
function adicionarColuna() {
  const nome = document.getElementById("novaColunaNome").value.trim();
  if (!nome) return alert("Informe um nome para a nova coluna");

  const quadro = document.getElementById("quadro-geral");
  const novaDiv = document.createElement("div");
  novaDiv.className = "coluna";
  novaDiv.innerHTML = `
    <h2 contenteditable="true">${nome}</h2>
    <button onclick="backupColuna('${nome}')" style="float:right">üíæ Backup</button>
    <button onclick="removerColuna(this)">üóëÔ∏è Remover</button>
    <div class="quadro" id="${nome.replace(/\s+/g, '_')}"></div>`;
  quadro.appendChild(novaDiv);
  document.getElementById("novaColunaNome").value = "";
}

function removerColuna(botao) {
  const coluna = botao.closest(".coluna");
  if (confirm("Deseja remover esta coluna?")) {
    coluna.remove();
  }
}
</script>
<script>
function verificarAniversariantesRepetido() {
  const hoje = new Date();
  const dia = String(hoje.getDate()).padStart(2, '0');
  const mes = String(hoje.getMonth() + 1).padStart(2, '0');
  const hojeStr = `${dia}/${mes}`;

  const clientes = document.querySelectorAll('#carteiraClientes .card');
  let aniversarios = [];

  clientes.forEach(card => {
    const dataNasc = card.getAttribute('data-nasc');
    if (!dataNasc) return;

    const partes = dataNasc.split('/');
    const dataFormatada = `${partes[0]}/${partes[1]}`;
    if (dataFormatada === hojeStr) {
      card.style.border = '2px solid gold';
      card.style.background = '#fff7d1';
      card.title = 'üéâ Aniversariante do dia!';
      aniversarios.push(card.querySelector("h4")?.innerText || "Cliente");
    }
  });

  if (aniversarios.length > 0 && !document.getElementById("alertaAniversario")) {
    const alerta = document.createElement('div');
    alerta.id = "alertaAniversario";
    alerta.innerHTML = `üéâ Hoje √© anivers√°rio de: <b>${aniversarios.join(", ")}</b>`;
    alerta.style = "background:#ffeeba;padding:10px;border:1px solid #ffc107;margin:10px 0";
    document.body.insertBefore(alerta, document.body.firstChild);
  }
}

// Verificar a cada 60 segundos
setInterval(verificarAniversariantesRepetido, 60000);
window.onload = verificarAniversariantesRepetido;
</script><script>
function enviarWhatsApp(nome, numero) {
  const nomeLimpo = nome || "Cliente";
  const numeroLimpo = numero.replace(/\D/g, ""); // Remove n√£o-d√≠gitos
  const texto = `Ol√° ${nomeLimpo}, tudo bem? Aqui √© da WM Assessoria. Vi que voc√™ demonstrou interesse e estou √† disposi√ß√£o para te ajudar no que precisar.`;
  const url = `https://wa.me/55${numeroLimpo}?text=${encodeURIComponent(texto)}`;
  window.open(url, '_blank');
}
</script><script>
function salvarKanban() {
  const quadro = document.getElementById("quadro-geral");
  if (quadro) localStorage.setItem("kanbanBackup", quadro.innerHTML);
}

function carregarKanban() {
  const quadro = document.getElementById("quadro-geral");
  const salvo = localStorage.getItem("kanbanBackup");
  if (quadro && salvo) quadro.innerHTML = salvo;
  setTimeout(() => {
    document.querySelectorAll('.card').forEach(card => {
      const nome = card.querySelector("h4")?.innerText || "";
      const numero = card.querySelector("p")?.innerText || "";
      const btn = document.createElement("button");
      btn.textContent = "üì≤ WhatsApp";
      btn.style = "margin-top:5px;display:block";
      btn.onclick = () => enviarWhatsApp(nome, numero);
      card.appendChild(btn);
    });
  }, 500);
}

window.onload = () => {
  carregarKanban();
  setInterval(salvarKanban, 3000);
};
</script><script>
function atualizarContagem() {
  const colunas = document.querySelectorAll(".coluna");
  let resumo = [];
  colunas.forEach(col => {
    const id = col.id || col.querySelector("h2")?.innerText || "Coluna";
    const qtde = col.querySelectorAll(".card").length;
    resumo.push(`${id}: ${qtde}`);
  });
  const painel = document.getElementById("contagemLeads");
  if (painel) painel.textContent = resumo.join(" | ");
}

// Atualizar a cada 5 segundos
setInterval(atualizarContagem, 5000);
window.onload = () => {
  if (typeof carregarKanban === "function") carregarKanban();
  setTimeout(atualizarContagem, 800);
};
</script></body>
</html>
