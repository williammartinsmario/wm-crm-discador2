
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>WM CRM & Discador</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #f7f9fc; }
    header, footer { background: #002b56; color: white; padding: 10px; }
    .kanban { display: flex; gap: 1rem; padding: 1rem; overflow-x: auto; }
    .coluna { background: white; border-radius: 8px; flex: 1; min-width: 250px; padding: 0.5rem; }
    .coluna h5 { margin-bottom: 0.5rem; }
    .card-contato { border: 1px solid #ddd; border-radius: 5px; padding: 0.5rem; margin-bottom: 0.5rem; background: #fff; }
    .card-contato button { margin: 2px; }
  </style>
</head>
<body>
  <header class="d-flex justify-content-between align-items-center">
    <div><strong>WM CRM & Discador</strong></div>
    <div>
      <input type="file" id="csvInput">
      <button class="btn btn-light btn-sm" onclick="colarContatos()">📋 Colar</button>
      <button class="btn btn-light btn-sm" onclick="abrirEditorEtapas()">⚙️ Etapas</button>
    </div>
  </header>

  <div class="kanban" id="kanbanBoard"></div>

  <footer class="text-center">
    © 2025 WM Assessoria
  </footer>

  <!-- Modal Agendamento -->
  <div class="modal" id="modalAgendamento" tabindex="-1">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header"><h5>Agendar Visita</h5></div>
      <div class="modal-body">
        <input type="text" id="nomeAgendamento" class="form-control mb-2" placeholder="Nome">
        <input type="text" id="numeroAgendamento" class="form-control mb-2" placeholder="Número">
        <input type="text" id="dataHoraAgendamento" class="form-control mb-2" placeholder="Data e hora">
        <select id="projetoAgendamento" class="form-control mb-2">
          <option value="">Selecione o Projeto</option>
          <option value="Seleto">Seleto Amoreiras</option>
          <option value="Rise">Rise Condomínio Clube</option>
          <option value="Mangará">Mangará Cores da Mata</option>
          <option value="Alentejo">Alentejo Residencial</option>
          <option value="Algarve">Algarve Residencial</option>
          <option value="Central">Central de Vendas</option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" onclick="confirmarAgendamento()">Confirmar</button>
      </div>
    </div></div>
  </div>

  <script>
    const projetos = {
      Seleto: {
        endereco: "R. Joaquim Lacerda Coelho, 647 – Jardim Capivari, Campinas – SP, 13050-800",
        maps: "https://maps.app.goo.gl/Rgs2wBWEGY1F3qwR8",
        resumo: "✔ 2 dorms\n✔ Varanda gourmet\n✔ Lazer completo"
      },
      Rise: {
        endereco: "Rua Bartirá, 340 – Vila Ipê, Campinas – SP",
        maps: "https://maps.app.goo.gl/HZgyx2rGDtFEFcLs7",
        resumo: "✔ 2 dorms\n✔ Condomínio clube\n✔ Lazer completo"
      },
      Mangará: {
        endereco: "Av. Graça Aranha, 175 – Vila Miguel Vicente Cury, Campinas – SP",
        maps: "https://maps.app.goo.gl/rYQrgLtEbRbjXvHZ9",
        resumo: "✔ 2 dorms com suíte\n✔ Varanda gourmet\n✔ Lazer completo"
      },
      Alentejo: {
        endereco: "Av. Graça Aranha, 175 – Vila Miguel Vicente Cury, Campinas – SP",
        maps: "https://maps.app.goo.gl/rYQrgLtEbRbjXvHZ9",
        resumo: "✔ 2 e 3 dorms\n✔ Fechadura eletrônica\n✔ Garagem proporcional"
      },
      Algarve: {
        endereco: "Av. Graça Aranha, 175 – Vila Miguel Vicente Cury, Campinas – SP",
        maps: "https://maps.app.goo.gl/rYQrgLtEbRbjXvHZ9",
        resumo: "✔ 2 e 3 dorms tipo/garden\n✔ Churrasqueira a gás\n✔ Piscina, coworking"
      },
      Central: {
        endereco: "Av. Maria Emília A. dos Santos de Angelis, 485 – Parque Prado, Campinas – SP",
        maps: "https://maps.app.goo.gl/3ayKMC2bF8hJL8TK9",
        resumo: "✔ Todos os projetos\n✔ Simulações e atendimento exclusivo"
      }
    };

    const etapas = ["Novo", "Em Atendimento", "Fechado"];
    let kanban = document.getElementById("kanbanBoard");

    function renderKanban() {
      kanban.innerHTML = "";
      etapas.forEach(etapa => {
        const col = document.createElement("div");
        col.className = "coluna";
        col.innerHTML = `<h5>${etapa}</h5><div id="col-${etapa}" class="dropzone"></div>`;
        kanban.appendChild(col);
        new Sortable(col.lastChild, { group: "kanban", animation: 150 });
      });
    }

    function addCard(nome, numero) {
      const card = document.createElement("div");
      card.className = "card-contato";
      card.innerHTML = `<b>${nome}</b><br>${numero}<br>
        <button class='btn btn-success btn-sm' onclick='abrirModal("${nome}", "${numero}")'>Agendar</button>
        <button class='btn btn-secondary btn-sm' onclick='ligar("${numero}")'>📞</button>`;
      document.getElementById("col-Novo").appendChild(card);
    }

    function abrirModal(nome, numero) {
      document.getElementById("nomeAgendamento").value = nome;
      document.getElementById("numeroAgendamento").value = numero;
      new bootstrap.Modal(document.getElementById("modalAgendamento")).show();
    }

    function confirmarAgendamento() {
      let nome = document.getElementById("nomeAgendamento").value;
      let numero = document.getElementById("numeroAgendamento").value;
      let data = document.getElementById("dataHoraAgendamento").value;
      let projeto = document.getElementById("projetoAgendamento").value;
      if (!projetos[projeto]) return alert("Projeto inválido");
      const p = projetos[projeto];
      const msg = `Olá ${nome}, tudo certo?\n\nConfirmando sua visita ao ${projeto}, localizado na ${p.endereco}.\n🕒 ${data}\n📍 ${p.maps}\n\n${p.resumo}\n\nTe espero no local! 😉`;
      window.open("https://wa.me/55" + numero + "?text=" + encodeURIComponent(msg), "_blank");
    }

    function ligar(numero) {
      alert("Ligando para " + numero);
    }

    function colarContatos() {
      navigator.clipboard.readText().then(text => {
        const linhas = text.split("\n");
        for (let linha of linhas) {
          let partes = linha.split(/[,;\t]+/);
          if (partes.length >= 2) {
            addCard(partes[0].trim(), partes[1].replace(/[^0-9]/g, ""));
          }
        }
      });
    }

    function abrirEditorEtapas() {
      const nova = prompt("Digite o nome da nova etapa:");
      if (nova) {
        etapas.push(nova);
        renderKanban();
      }
    }

    document.getElementById("csvInput").addEventListener("change", e => {
      const reader = new FileReader();
      reader.onload = function() {
        const linhas = reader.result.split("\n");
        for (let linha of linhas) {
          let partes = linha.split(/[,;\t]+/);
          if (partes.length >= 2) {
            addCard(partes[0].trim(), partes[1].replace(/[^0-9]/g, ""));
          }
        }
      }
      reader.readAsText(e.target.files[0]);
    });

    renderKanban();
  </script>
</body>
</html>
